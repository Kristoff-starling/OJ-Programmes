# 简单简单数学 题解

## 题面概括
- 给定数列$\{A_n\}$和$\{B_m\}$，求$\sum_{i=1}^n\sum_{j=1}^mf[\mid A_i-B_j\mid]$，其中$f[n]$表示斐波那契数列的第$n$项
- $\sum_{i=1}^nA_i\leq 10^6$，$\sum_{i=1}^mB_i\leq 10^6$，$A_i,B_i\geq 0$

## 题解1
显然相同的$A_i$可以合并，我们构造新数列$\{A'_N\}$和$\{B'_M\}$，表示$\{A_n\}$和$\{B_m\}$中所有出现过的不同的数构成的数列，则答案可以化为

$\sum_{i=1}^N\sum_{j=1}^Mf[\mid A'_i-B'_j\mid]\cdot cnt_A[A'_i]\cdot cnt_B[B'_j]$，

其中$cnt_A[x]$表示$x$在$\{A_n\}$中出现的次数，$cnt_B[x]$的定义类似。

我们来考虑$N$和$M$的量级。$N$最大的情况是$\{A'_N\}=1,2,3,4...$，这样$\sum_{i=1}^NA'_i=\frac{1}{2}N(N+1)\leq \sum_{i=1}^nA_i\leq 10^6$，所以$N$最大是$\sqrt{10^6}$级别的，$M$同理

记$\sum_{i=1}^nA_i=T$，则总时间复杂度$O(T)$。

## 加强题面
- 将$\sum_{i=1}^nA_i,\sum_{i=1}^mB_i\leq 10^6$改为$0\leq A_i,B_i\leq 10^6,n,m\leq 10^6$

## 题解2
假设$n,m$同阶

先将$\{A_n\}$和$\{B_m\}$排序，由于数列中的数很小，所以可以用基数排序做到$O(n)$
***
斐波那契数列的递推式是$f[n]=f[n-1]+f[n-2](n\geq 2)$，那么可以得到推论：记

$F[0]=f[a_1]+f[a_2]+...+f[a_n]$

$F[1]=f[a_1+1]+f[a_2+1]+...+f[a_n+1]$

……

$F[t]=f[a_1+t]+f[a_2+t]+...+f[a_n+t]$

则易证$F[n]$依然满足递推式$F[n]=F[n-1]+F[n-2]$
***
题目原式中的绝对值不便于处理。考虑对于每个$A_i$，只处理比它小的$B_j$，同样对于每个$B_i$只处理比它小的$A_j$。

在两个数列已经排序完成的情况下，形式化地，记$a_i$为最大的满足$B_{a_i}\leq A_i$的数，$b_i$为最大的满足$A_{b_i}< B_i$的数，则答案可化为

$\sum_{i=1}^n\sum_{j=1}^{a_i}f[A_i-B_j]+\sum_{i=1}^m\sum_{j=1}^{b_i}f[B_i-A_j]$

因为$\{A_n\}$和$\{B_m\}$是（非严格）单调增的，所以$\{a_n\}$和$\{b_m\}$都是（非严格）单调增的。我们从1~n枚举所有的$A_i$，假设我们现在有$ans_{A_i}=\sum_{j=1}^{a_i}f[A_i-B_j]$，我们想要求$ans_{A_{i+1}}$

$ans_{A_{i+1}}=\sum_{i=1}^{a_{i+1}}f[A_i-B_j]=\sum_{j=1}^{a_i}f[A_{i+1}-B_j]+\sum_{j=a_i+1}^{a_{i+1}}f[A_{i+1}-B_j]$

根据之前的推论，$ans_{A_{i+1}}$的前半部分可以用递推式递推得到，所以我们在维护$ans_{A_i}$的时候同时维护“$F[n]$”的前一项的值。这其中有一些实现细节请读者自己思考。$ans_{A_{i+1}}$的后半部分暴力计算即可。

我们分析复杂度。前一半递推的内容是$O(max\{A_i\})$级别的。后一半由于$\{a_n\}$单增，所以是$O(n)$级别的。另一半枚举$\{B_m\}$的过程类似。所以总复杂度线性。